import{C as u}from"./index-CWZxJKc-.js";class d{constructor(){this.baseURL=u.API_BASE,this.timeout=5e3}async request(e,s={}){const t=`${this.baseURL}${e}`,a={method:"GET",headers:{"Content-Type":"application/json",...s.headers},...s};try{console.log(`[API] 🌐 ${a.method} ${t}`);const r=new AbortController,i=setTimeout(()=>r.abort(),this.timeout),o=await fetch(t,{...a,signal:r.signal});if(clearTimeout(i),!o.ok)throw new c(o.status,o.statusText,t);const n=await o.json();return console.log(`[API] ✅ ${a.method} ${t} - Success`),n}catch(r){throw console.error(`[API] ❌ ${a.method} ${t} - Failed:`,r.message),r.name==="AbortError"?new c(408,"Request timeout",t):r instanceof c?r:new c(0,"Network error",t,r)}}async get(e,s={}){return this.request(e,{...s,method:"GET"})}async post(e,s=null,t={}){return this.request(e,{...t,method:"POST",body:s?JSON.stringify(s):null})}async put(e,s=null,t={}){return this.request(e,{...t,method:"PUT",body:s?JSON.stringify(s):null})}async delete(e,s={}){return this.request(e,{...s,method:"DELETE"})}async patch(e,s=null,t={}){return this.request(e,{...t,method:"PATCH",body:s?JSON.stringify(s):null})}async upload(e,s,t={}){const a={...t,method:"POST",body:s,headers:{...t.headers}};return delete a.headers["Content-Type"],this.request(e,a)}async ping(e="/health"){try{return await this.get(e),!0}catch{return!1}}setTimeout(e){this.timeout=e}getBaseURL(){return this.baseURL}setBaseURL(e){this.baseURL=e}}class c extends Error{constructor(e,s,t,a=null){super(`API Error ${e}: ${s} (${t})`),this.name="APIError",this.status=e,this.statusText=s,this.url=t,this.originalError=a}isNetworkError(){return this.status===0||this.status===408}isServerError(){return this.status>=500&&this.status<600}isClientError(){return this.status>=400&&this.status<500}getUserMessage(){return this.isNetworkError()?"Unable to connect to server. Please check your internet connection.":this.status===404?"The requested resource was not found.":this.status===403?"You do not have permission to access this resource.":this.status===401?"Authentication required. Please log in.":this.isServerError()?"Server error. Please try again later.":this.message}}const l=new d;class g{constructor(){this.cache=new Map,this.cacheExpiry=300*1e3,this.lastFetch=null}async getDeals(e={}){const{forceRefresh:s=!1,category:t,maxPrice:a,sortBy:r="popularity"}=e;try{if(!s&&this.isCacheValid())return console.log("[Deals] 💾 Returning cached deals"),this.applyFilters(this.cache.get("deals"),{category:t,maxPrice:a,sortBy:r});console.log("[Deals] 🌐 Fetching deals from server");const o=(await l.get("/deals")).map(n=>({...n,discountPercentage:n.originalPrice?Math.round((1-n.price/n.originalPrice)*100):0,isPopular:n.bookings>100,isNew:Date.now()-new Date(n.createdAt).getTime()<10080*60*1e3,id:n.id||Date.now(),title:n.title||"Untitled Deal",price:n.price||0,description:n.description||"",imageUrl:n.imageUrl||"/fallback-image.png",category:n.category||"other",rating:n.rating||0,reviewCount:n.reviewCount||0,bookings:n.bookings||0,createdAt:n.createdAt||new Date().toISOString()}));return this.cache.set("deals",o),this.lastFetch=Date.now(),console.log(`[Deals] ✅ Fetched ${o.length} deals`),this.applyFilters(o,{category:t,maxPrice:a,sortBy:r})}catch(i){return console.error("[Deals] ❌ Failed to fetch deals:",i),this.cache.has("deals")?(console.log("[Deals] 📴 Using cached deals as fallback"),this.applyFilters(this.cache.get("deals"),{category:t,maxPrice:a,sortBy:r})):(console.log("[Deals] 🎭 Using mock deals as fallback"),this.getMockDeals())}}async getDeal(e){try{const s=await l.get(`/deals/${e}`);return console.log(`[Deals] ✅ Fetched deal ${e}`),s}catch(s){console.error(`[Deals] ❌ Failed to fetch deal ${e}:`,s);const t=this.cache.get("deals");if(t){const a=t.find(r=>r.id==e);if(a)return console.log(`[Deals] 💾 Found deal ${e} in cache`),a}throw s}}async searchDeals(e,s={}){const t=await this.getDeals(s);if(!e||e.trim()==="")return t;const a=e.toLowerCase().trim();return t.filter(r=>r.title.toLowerCase().includes(a)||r.description.toLowerCase().includes(a)||r.category.toLowerCase().includes(a)||r.destination&&r.destination.toLowerCase().includes(a))}async getDealsByCategory(e){return this.getDeals({category:e})}async getPopularDeals(e=10){return(await this.getDeals({sortBy:"popularity"})).filter(t=>t.isPopular).slice(0,e)}async getNewDeals(e=10){return(await this.getDeals({sortBy:"date"})).filter(t=>t.isNew).slice(0,e)}async bookDeal(e,s){try{const t=await l.post(`/deals/${e}/book`,s);return console.log(`[Deals] ✅ Booked deal ${e}`),t}catch(t){throw console.error(`[Deals] ❌ Failed to book deal ${e}:`,t),t}}async getCategories(){try{return await l.get("/deals/categories")}catch{return[{id:"beach",name:"Beach",icon:"🏖️"},{id:"mountain",name:"Mountain",icon:"🏔️"},{id:"city",name:"City",icon:"🏛️"},{id:"adventure",name:"Adventure",icon:"🎢"},{id:"culture",name:"Culture",icon:"🎭"},{id:"food",name:"Food & Wine",icon:"🍷"}]}}applyFilters(e,{category:s,maxPrice:t,sortBy:a="popularity"}={}){let r=[...e];switch(s&&s!=="all"&&(r=r.filter(i=>i.category===s)),t&&t>0&&(r=r.filter(i=>i.price<=t)),a){case"price-low":r.sort((i,o)=>i.price-o.price);break;case"price-high":r.sort((i,o)=>o.price-i.price);break;case"popularity":r.sort((i,o)=>o.bookings-i.bookings);break;case"rating":r.sort((i,o)=>o.rating-i.rating);break;case"date":case"recent":r.sort((i,o)=>new Date(o.createdAt)-new Date(i.createdAt));break}return r}isCacheValid(){return this.cache.has("deals")&&this.lastFetch&&Date.now()-this.lastFetch<this.cacheExpiry}clearCache(){this.cache.clear(),this.lastFetch=null,console.log("[Deals] 🧹 Cache cleared")}getMockDeals(){return[{id:1,title:"Weekend in Rome",description:"Experience the eternal city with our amazing weekend package including flights, hotel, and guided tours.",price:299,originalPrice:399,discountPercentage:25,category:"city",destination:"Rome, Italy",imageUrl:"/fallback-image.png",rating:4.8,reviewCount:142,bookings:1250,isPopular:!0,isNew:!1,createdAt:new Date(Date.now()-2880*60*1e3).toISOString()},{id:2,title:"Bali Beach Retreat",description:"Relax on pristine beaches with our 5-day Bali package. Includes luxury resort accommodation and spa treatments.",price:599,originalPrice:799,discountPercentage:25,category:"beach",destination:"Bali, Indonesia",imageUrl:"/fallback-image.png",rating:4.9,reviewCount:89,bookings:856,isPopular:!0,isNew:!0,createdAt:new Date(Date.now()-1440*60*1e3).toISOString()},{id:3,title:"Swiss Alps Adventure",description:"Hiking and skiing in the beautiful Swiss Alps. Perfect for adventure seekers and nature lovers.",price:899,originalPrice:1199,discountPercentage:25,category:"mountain",destination:"Swiss Alps, Switzerland",imageUrl:"/fallback-image.png",rating:4.7,reviewCount:203,bookings:432,isPopular:!1,isNew:!1,createdAt:new Date(Date.now()-7200*60*1e3).toISOString()}]}getCacheStats(){return{hasCachedDeals:this.cache.has("deals"),cachedDealsCount:this.cache.has("deals")?this.cache.get("deals").length:0,lastFetch:this.lastFetch,cacheAge:this.lastFetch?Date.now()-this.lastFetch:null,cacheValid:this.isCacheValid()}}}const w=new g;export{g as DealsService,w as default};
